AbilityFactory parses differently from the Keyword parser. Your Ability line will look more like a collection of name-value pairs:

`A:<AB/SP/DB/ST>$ <AFSubclass> | <Necessary$ Parameters> | (<Separated$ By> | <Pipes$ Here>) | [Optional$ {Values} [Nested$ Dependency]]`

The ability types are:
- **AB** for Activated Abilities
- **SP** for Spell
- **DB** for Drawback and many abilities that are subsidiary to other things, like replacements. They are only used to chain AFs together, and will never be the root AF
- **ST** for Static, this gets used in case the API should resolve without using the stack<br /> (e.g. the unique *Circling Vultures* special action is directly implemented in the script this way)

Syntax definitions like the above will use different symbols to separate the variable parts from the plaintext:
- angle brackets for mandatory parts
- square brackets for optional parts
- round brackets for grouping parts that are exclusive to each other
- curly brackets to denote the type of a parameter

>*NOTE:*
> - these factories are refactored from time to time (often to adapt to new sets), so while some entries could be slightly outdated, the base information should still be correct
> - when in doubt you can always cross-check with the [available APIs](https://github.com/Card-Forge/forge/tree/master/forge-game/src/main/java/forge/game/ability/effects) code
> - a few factories also have _*All_ variants, these are slowly being phased out
> - some parameters are only added for very exotic cards, these won't be included here to keep the focus on understanding the general concepts of scripting
> - a good knowledge of the game rules is often helpful for some of the more complex cases covered

# Common Parameters

## Cost / UnlessCost
`Cost$ {AbilityCost}` is the appropriate way to set the cost of the ability. Currently for spells, any additional costs including the original Mana cost need to appear in the Cost param in the AbilityFactory. For each card that uses it, the order in which the cost is paid will always be the same.

Secondary abilities such as the DB executed by triggers or replacements (usually) don't need costs. (This is one reason to use DB over AB in these cases.)

Read more about it in [Costs](Costs.md)

## Defined / ValidTgts
Most effects need to know (at least implicitly) which players or objects they're trying to affect. There are two different ways for that:
- `Defined$ {Defined}` if the ability describes on what it's applied
- `ValidTgts$ {Valid}` for abilities that target

Read more about it in [Affected / Targets](Targeting.md)

## Restrictions / Conditions
Restrictions limit when abilities can be put on the stack and Conditions apply during resolving. Typical examples are "Activate only once each turn" or "If this spellâ€™s additional cost was paid, [...]".

Read more about it in [Restriction](Restrictions.md)

## SpellDescription
`SpellDescription$ {String}` is how the text of the ability will display on the card and in the option dialog for cards with multiple abilities.

The SpellDescription for secondary abilities is displayed when (and if) the ability prompts for user input in the prompt pane so it is useful to put some text there or rather split the text into the different effect parts.

## StackDescription
`StackDescription$ {String}` is the description the ability will have on the stack. This is automatically generated by the effect, but may be overridden using this parameter. This is sometimes needed with complex effects, when the generated text can't handle some details. Properties of the spell can be accessed like this: `{c:Targeted}`. You can reuse the spell text by just putting `SpellDescription` or `None` to leave it empty.

## Remember*
Remembering is often needed when a card becomes a new object, which is then further affected by the ability. Typical example: [Flicker](https://github.com/Card-Forge/forge/blob/master/forge-gui/res/cardsfolder/f/flicker.txt)<br />
Because cards keep their remembered parts when changing zones manual [cleanup](#Cleanup) is usually required.

## Duration
- Permanent (Default is end of turn)
- UntilEndOfCombat - if the effect should last only until End of Combat instead of End of Turn
- UntilHostLeavesPlay - if the effect should last as long as the host is still in play
- UntilYourNextUpkeep
- UntilControllerNextUntap
- UntilYourNextTurn

## AI params
* `IsCurse$ True` - For effects that are normally treated positive e.g. Pump

* `AICheckSVar$ {Count}`

* `AILogic$ {String}`

* `AITgts$ BetterThanEvalRating.130`
Normally the AI will only prefer targeting cards that satisfy the constraint. However you can add `AITgtsStrict$ True` if playing it should only happen when enough of these cards are available, e.g. *Rootwater Matriarch*.

# Factories (in Alphabetical Order)

## Animate
Animate handles animation effects like "This card becomes a 5/5 green creature with flying until end of turn."

Parameters:
- `Power` - the power to assign to the animated card
- `Toughness` - the toughness to assign to the animated card
- `Types` - the additional types to give the animated card; comma delimited
- `OverwriteTypes$ True` - if the animated being should have these types **instead** as opposed to **in addition to**
- `RemoveTypes` - a list of types to Remove from the animated card
- `Keyword` - a " & " delimited list of keywords to give the animated being (just like AB$Pump)
- `RemoveKeywords` - a " & " delimited list of keywords to remove from the animated being (just like AB$Debuff)
- `Colors` - a comma-delimited list of Colors to give to the animated being (capitalized and spelled out) (ChosenColor accepted)
- `Abilities` - a comma-delimited list of SVar names which contain abilities that should be granted to the animated being
- `Triggers` - a comma-delimited list of SVar names which contain triggers that should be granted to the animated being
- `staticAbilities` - a comma-delimited list of SVar names which contain static abilities that should be granted to the animated being
- `RemoveAllAbilities` - Remove all Abilities, Triggers, Statics, and Replacement effects
- `sVars` - a comma-delimited list of SVars that should be granted to the animated being

## Attach
Parameters:

- Object (optional) - This is the Object that will be Attached (generally the Source Card for Auras)
- AttachAILogic - AI Logic tells the AI which base AI code it should use for Attaching
  - GainControl - Gains Control of the Attached Permanent (Control Magic)
  - Curse - A Generic Curse the AI has a handful of checks to see what the most appropriate Target is.
  - Pump - A Generic Pump. The AI has a handful of checks to see what the most appropriate Target is.
  - ChangeType - For Attachments that change types. Evil Presence is a good example.

## BecomeMonarch
No own parameters.

## Bond
Soulbonding two creatures. Only used internally by the engine.

## Branch
Sometimes, an ability might do certain things when a specific condition is true, and other things if not. This can be implemented by using `Branch`.
The branch evaluates the SVar specified by the property `BranchConditionSVar`, using the comparison defined with `BranchConditionSVarCompare` (such as `GTY`, `LT1`, etc.). Depending on whether the condition evaluated to true or false, the subability defined by `TrueSubAbility` or `FalseSubAbility` is executed.

The example below is from *Composer of Spring*, which allows either a "land" or a "land or creature" to be put on the battlefield, depending on the number of enchantments in play under your control.

```
SVar:TrigBranch:DB$ Branch | BranchConditionSVar$ X | BranchConditionSVarCompare$ GE6 | TrueSubAbility$ PutLandCreature | FalseSubAbility$ PutLand
SVar:PutLand:DB$ ChangeZone | Origin$ Hand | Destination$ Battlefield | Tapped$ True | ChangeType$ Land.YouOwn
SVar:PutLandCreature:DB$ ChangeZone | Origin$ Hand | Destination$ Battlefield | Tapped$ True | ChangeType$ Creature.YouOwn,Land.YouOwn
SVar:X:Count$Valid Enchantment.YouCtrl
```

## Charm
This allows cards that have a mode to be chosen.

Parameters:
- `CharmNum` - Number of Modes to Choose
- `Choices` - A Comma delimited list of SVars containing the Modes

## Choices
These can be used to chain effects together. However, for common cases many effects already support this directly, e.g. `PutCounter | Choices$``.  
Besides making the script shorter using such shortcuts usually also helps the AI making better use of the effect.

### ChooseType
This can be used when a player is asked to choose a card (sub)type.

Parameters:
- `Type` - Required - Can be Card or Creature
- `InvalidTypes` - Optional - Use to specify any type that cannot be chosen (ex: "Choose any creature type except Wall")

## Clash
This AF handles clashing.

Parameters:
- `WinSubAbility$ <SubAbility>` optional
- `OtherwiseSubAbility`

## Cleanup
A non-functional, maintenance AF used for Cleaning up certain Variables before a Spell finishes Resolving.

Parameters:
- `ClearRemembered$` Set to True to clear this card's remembered list. Generally useful for Cards that Remember a card, do something to it, then need to forget it once it's done.
- `ClearImprinted$` Set to True to clear the list of imprinted cards.
- `ClearChosenCard$` Set to True to clear the chosen cards.

## Control

### GainControl
Parameters:
- `NewController$ {Defined}`

### ControlExchange

### ControlPlayer

### ControlSpell

## Copies

### CopyPermanent
Copies a permanent.

Parameters:
- `NumCopies` - optional - the number of copies to put onto the battlefield.
- `Keywords` - optional - a list of keywords to add to the copies

### CopySpellAbility
Parameters:
- `Num$ <Integer>` Default:1

## Counter
Countering Spells or Abilities.

Parameters:
- `Destination` - send countered spell to: (only applies to Spells; ignored for Abilities)
    - TopDeck

## Counters
Factories to handle counters on cards.

### Poison
Poison gives a player the specified number of poison counters.

Parameters:
- `Num` (required) - the number of poison counters to give

### PutCounter
Put any type of counter on a game object.

Parameters:
- `CounterType` (required) specifies the type of counter and should appear in all caps. It should be one of the values in the Counters enum.
- `CounterNum` (required) specifies how many counters will be put on the chosen card.

### RemoveCounter
Remove any type of counter from a card.

  - CounterType (required) specifies the type of counter and should
    appear in all caps. It should be one of the values in the Counters
    enum.
  - CounterNum (required) specifies how many counters will be removed
    from the chosen card.
  - UpTo is optional. If an effect states you may remove "up to X
    counters", set this to True.

### Proliferate

### MoveCounters
Used for cards that Move Counters.

Parameters:
- `Source` - The Source of the Moving Counters
- `Defined` - The Destination of the Moving Counters
- `CounterType` - The type of counter to move
- `CounterNum` - The number of counters to move

## Damage

### DealDamage
Deal damage to a specified player or permanent.

Parameters:
- `NumDmg` is required. This is the amount of damage dealt

### EachDamage

## Debuff
Removing Keywords.

Parameters:
- `Keywords`
- `Duration`

## Destroy
Handles destruction of permanents.

## Effect
Effect is an oddball of the AF family. Where usually AFs have similarities to each other to help with AI use, Effect doesn't fall under that jurisdiction. In general, an effect is some type of SA that lasts longer than its resolution.

A good example is High Tide. For the rest of the turn, High Tide makes all Islands produce an extra mana. It doesn't matter if the Island was in play, if it turned into an Island after High Tide was cast, any of that.

`A:SP$ Effect | Cost$ U | Name$ High Tide Effect | Triggers$ IslandTrigger | SVars$ TrigMana | SpellDescription$ Until end of turn, whenever a player taps an Island for mana, that player adds U to his or her mana pool (in addition to the mana the land produces).`  
`SVar:IslandTrigger:Mode$ TapsForMana | ValidCard$ Island | Execute$ TrigMana | TriggerDescription$ Whenever a player taps an Island for mana, that player adds U to his or her mana pool (in addition to the mana the land produces).`  
`SVar:TrigMana:AB$Mana | Cost$ 0 | Produced$ U | Amount$ 1`

Effect is most similar to Token as it creates a pseudo-permanent, except Effect creates in the command zone rather than the battlefield. It stays active there for a set Duration.

Parameters:
- `Abilities,Triggers,SVars` are comma separated lists which contain
  SVars that point to the appropriate type that the Effect will gain.
- `Duration` is how long the Effect lasts
- Stackable$ False - Most Effects are assumed to be Stackable. By
  setting the Stackable Flag to False, the AI will know having a
  second one in play is useless, so will save it's Resource for
  something else.
- Image - a file\_name\_without\_extension (image needs to reside in
  the tokens directory)

## Explore

## Fight

## Fog
Fog is an ability based on the original Fog spell: "Prevent all combat damage that would be dealt this turn." While this could be done with an effect, the specialized nature of the AI gives it its own AF.

## GainLife / LoseLife / SetLife
Have a player gain or lose the specified amount of life.

Parameters:  
LifeAmount (required) - the value to set the life total(s) to

## Game outcome

### GameDraw

### GameLoss

### GameWin

### RestartGame
Used in the script of *Karn Liberated*.

## Goad

## Mana
For lands or other permanent to produce mana.

## Manifest

## Permanent State
API for things that alter a permanent's state.

### Phases

### SetState
Changing a cards State. This is mostly for Flip Cards or the Transform mechanic.

### Tap

### TapOrUntap

### Untap

## Play
Playing a card or cards as part of SA. The player may have to make a choice about which card to play if there are more choices than the number of cards to play.

Parameters:
- `Amount` - How many cards can be played (a non-negative integer or "All")
- `Valid` - Selection criteria for valid cards from the zone to cast
- `ValidSA` - Applied after Valid, this will filter based on all spells of the cards
- `ValidZone` - The zone to look in to determine the valid cards
- `ShowCards` - Other cards in the zone to show when selecting valid cards
- `Optional` - Casting the card is optional
- `RememberPlayed` - Remember the card played
- `WithoutManaCost` - The card can be cast without mana payment

## PreventDamage

## Protection
Protection grants protection from colors or cards types, or creature types.

Parameters:
- `Gains` - required - the thing to gain protection from (green, artifacts,
Demons, etc.) or "Choice" if you can choose one of a comma-delimited list of Choices$

## Pump
This factory handles pumping creatures power/toughness or granting abilities to permanents (usually creatures).

Parameters:
`NumAtt$` is optional, will pump Power.
`NumDef$` is optional, will pump Toughness.
`KW$` is optional, will give temporary keywords.

## Regenerate
Regenerate is for creating Regeneration shields.

## Repeat
Repeat the specified ability.

### Repeat
`A:SP$ Repeat | Cost$ 3 B B | RepeatSubAbility$ DBDig | RepeatOptional$ True`

Parameters:
- `MaxRepeat` - optional - the maxium times to repeat, execute repeat ability at least once
- `RepeatSubAbility` - required - setup subability to repeat
- `RepeatOptional` - optional - you make the choice whether to repeat the process
- RepeatPresent, RepeatCompare, RepeatDefined, RepeatCheckSVar, RepeatSVarCompare - optional - condition check

### RepeatEach
Parameters:
- `RepeatSubAbility` - required - to set up repeat subability
- `RepeatCards` - to repeat for each valid card (zone: present zone of the valid repeat cards, default: battlefield)
- `DefinedCards`
- `RepeatPlayers` - to repeat for each valid player
- `RepeatCounters` - to repeat for each valid counters

## Reveal

### RevealHand
Look at a player's hand.

### Reveal
Parameters:
- `RevealValid` to limit the valid cards
- `AnyNumber`
- `Random`
- `RememberRevealed:` to remember the cards revealed

### PeekAndReveal
This AF is very similar to things that Dig can do, but handle a much simpler form, with less complex coding underneath. Similar to how RearrangeTopOfLibrary could be handled with Dig.

Primarily used with cards that allow you to Peek at the top card of your library, and allow you to reveal it if it's of a certain type. The Kinship cards fit this bill perfectly, so they are used to simplify the complex popups that would be required if using multiple Dig SubAbilities.

Parameters:
- `RevealOptional` - Whether or not the Reveal is optional.
- `RememberRevealed` - Whether to remember the revealed cards (after filtering by Valid)
- `RememberPeeked` - Whether to remember the peeked cards (only if they are not revealed\!)
- `RevealValid` - defaults to Card, but allows you to set a specific ValidType if you can only have certain things
- `PeekAmount` - defaults to 1, but allows you to peek at multiple cards if possible

## RollDice

## Sacrifice
Usually you choose a player and that player has to sacrifice something of their choice

## Scry

## StoreSVar

## Tokens

### Amass

### Investigate

### Token
Token simply lets you create tokens of any type.

This ability factory does not take a target.

You can also use the parameters TokenAbilities$, TokenTriggers$ and TokenSVars$ to give the created tokens any number of either. For example, here's how Growth Spasm creates an Eldrazi Spawn token complete with ability.

    SVar:DBToken:DB$Token | TokenAmount$ 1 | TokenName$ Eldrazi Spawn | TokenTypes$ Creature,Eldrazi,Spawn | TokenOwner$ You | TokenColors$ Colorless | TokenPower$ 0 | TokenToughness$ 1 | TokenAbilities$ ABMana SVar:ABMana:AB$Mana | Cost$ Sac<1/CARDNAME> | Produced$ 1 | Amount$ 1 | SpellDescription$ Add 1 to your mana pool. 

## Triggers
If possible split the SpellDescription of the effect so the part for the trigger can become the StackDescription directly.

### DelayedTrigger
The trigger-specific params are defined in [Triggers](Triggers.md).

### ImmediateTrigger
TriggerAmount

## Turn structure

### AddPhase

### AddTurn

### EndTurn

### ReverseTurnOrder

### SkipPhase

### SkipTurn

## Vote

## Zone Affecting
For effects that handle zones in a specific manner.

### ChangeZone
ChangeZone is a united front of any card that changes zone. This does not include: drawing, discarding, destroying, or milling, as these represent specific words on which triggers and replacements can react.

- `Origin` is where the card is coming from.
- `Destination` is where the card is going to.
If Destination is Library, a LibraryPosition is recommended, but not required. **Default value of the LibraryPosition is 0.** 0 represents the top of the library, -1 represents the bottom.

There are two primary forms, but the distinction is handled mostly in the codebase.

#### Hidden Origin
The first is hidden, generally used for Origin zones that are not known information, e.g. the Library. The choice of "What card is changing zones?" happens during resolution.

`A:SP$ ChangeZone | Cost$ W | Origin$ Library | Destination$ Library | LibraryPosition$ 0 | ChangeType$ Artifact,Enchantment | ChangeNum$ 1 | SpellDescription$ Search your library for an artifact or enchantment card and reveal that card. Shuffle your library, then put the card on top of it.`

Parameters:
- `ChangeType`
- `ChangeNum`
- `Chooser` defines which player has to decide which card changes zone.
- `Mandatory` most of these abilities are not mandatory, but some are.

#### Known Origin
The second is known, generally used for Origin zones that are known information, like the Battlefield or the Graveyard. The choice of "What card is changing zones?" happens on activation.

`A:AB$ ChangeZone | Cost$ 1 U T | TgtPrompt$ Choose target artifact card in your graveyard | ValidTgts$ Artifact.YouCtrl | Origin$ Graveyard | Destination$ Library | SpellDescription$ Put target artifact card from your graveyard on top of your library.`

### ChangeZoneResolve
This is a helper AF, for chained effects that create multiple permanents which should enter the battlefield at the same time.

To use it, you need to set the param "ChangeZoneTable" on the first effect and then call this at the end.

This is supported by the following effects:
- Amass
- CopyPermanent
- RepeatEach (_NOTE: if you wrap the creation, you don't need to call this AF on its own_)
- Token

### Dig
Dig is for an ability that does basically this: "You look at the X cards of your Library, put Y of them somewhere, then put the rest somewhere."

Parameters:
- `DigNum` - Required - look at the top number of cards of your library
- `Reveal` - Optional - for abilities that say "Reveal the top X cards of your library". Default is false.
- `SourceZone` - Optional - the zone to dig in. Default is Library
- `DestinationZone` - Optional - the zone to put the Y cards in. Default is Hand
- `LibraryPosition` - Optional - if DestinationZone is Library, use this to specify position. Default is -1 (bottom of library)
- `ChangeNum` - Optional - the number of cards to move to the DestinationZone (or "All" when it's for things like "put all lands revealed this way into your hand"). Default is 1.
- `ChangeValid` - Optional - use this to specify if "you may move an artifact to DestinationZone". Default is any Card
- `AnyNumber` - Optional - use if you can move any number of Cards to DestinationZone. Default is false. (think of Lead the Stampede)
- `Optional` - Optional - set this if you "may" move a card to DestinationZone. Default is false.
- `DestinationZone2` - Optional - the zone to put the rest of the cards in. If it is library, you are prompted for the order. Default is Library.
- `LibraryPosition2` - Optional - if DestinationZone2 is Library, use this to specify position. Default is -1 (bottom of library).

### DigUntil

### Discard

Parameters:
- `NumCards` - the number of cards to be discarded
- Mode - the mode of discard - should match spDiscard
     - Random
     - TgtChoose
     - RevealYouChoose
     - Hand
 - `DiscardValid` - a ValidCards syntax for acceptable cards to discard
 - `UnlessType` - a ValidCards expression for "discard X unless you discard <Type>"

### Draw

### Mill

### RearrangeTopOfLibrary

### Shuffle
Used for shuffling a player's library.

Parameters:
- `Optional$ True` - Set this param if the activator gets to decide if each affected player shuffles

### TwoPiles
